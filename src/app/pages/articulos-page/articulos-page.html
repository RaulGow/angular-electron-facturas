<div class="articulos-page">
    <div class="header">
        <div class="header-left">
            <h1>Articulos</h1>
            <p>Edicion de articulos del sistema.</p>
        </div>

        <div class="header-right">
            <p class="date">{{ fechaFormateada }}</p>

        </div>
    </div>

    <div class="actions">
        <app-action-button
          label="Volver al Panel"
          icon="assets/icons/arrow-go-back-fill.svg"
          variant="primary"
          link="/dashboard"
          [isWhiteIcon]="true">
        </app-action-button>

        <app-action-button
          label="Añadir Artículo"
          icon="assets/icons/add-circle-line.svg"
          variant="secondary"
          (onClick)="showModal.set(true)">
        </app-action-button>

        <app-action-button
          label="Modificar Artículo"
          icon="assets/icons/draft-line.svg"
          variant="secondary"
          (onClick)="miFuncionParaAbrirModal()">
        </app-action-button>
    </div>

    <div class="sumary">
      <table class="sumary-table">
        <thead>
          <tr>
            <th class="sumary-table-number">Ref.</th>
            <th>Descripción</th>
            <th>Categoría</th>
            <th>Stock</th>
            <th>Precio</th>
            <th>IVA</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (art of articulos; track art.id) {
            <tr>
              <td class="sumary-table-number">#{{ art.id.toString().padStart(4, '0') }}</td>
              <td class="sumary-table-description">{{ art.nombre }}</td>
              <td>
                @let nombreCat = getNombreCategoria(art.categoria_id);
                <span class="badge-categoria" [ngClass]="getCategoryClass(nombreCat)">
                  {{ nombreCat }}
                </span>
              </td>
              <td>{{ art.stock }} <small>{{ art.unidadMedida }}</small></td>
              <td class="sumary-table-price">
                <span>{{ art.precio_venta.toFixed(2) }}€</span>
              </td>
              <td>
                <span class="iva-info">({{ art.iva }}% IVA)</span>
              </td>
              <td>
                <div class="table-row-actions">
                  <button class="edit-btn" (click)="miFuncionParaAbrirModal()">
                    Editar
                  </button>
                </div>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="6" style="text-align: center; padding: 2rem;">
                No hay artículos disponibles.
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
</div>

<!-- modal -->
<app-custom-modal
  title="Añadir nuevo Artículo"
  [isOpen]="showModal()"
  btnPrimaryLabel="Guardar Artículo"
  btnSecondaryLabel="Volver"
  btnExtraLabel="Ayuda"
  [btnPrimaryDisabled]="articuloForm.invalid"
  (onPrimary)="guardarArticulo()"
  (onSecondary)="showModal.set(false)"
  (onClose)="showModal.set(false)"
>
  <h3>Rellena todos los campos requeridos</h3>
  <br/>
  <br/>
  
  <form [formGroup]="articuloForm" (ngSubmit)="guardarArticulo()">
  
    <app-input-generic 
      label="Nombre del Producto"
      formControlName="nombre"
      placeholder="Ej: Jamón Ibérico de Bellota"
      [error]="articuloForm.get('nombre')?.touched && articuloForm.get('nombre')?.invalid ? 'El nombre debe tener al menos 3 caracteres' : null"
    />

    <div class="form-row">
      <app-input-generic 
        label="Precio de Venta"
        type="number"
        formControlName="precio"
        suffix="€/Kg"
        placeholder="0.00"
        [error]="articuloForm.get('precio')?.touched && articuloForm.get('precio')?.invalid ? 'Precio requerido' : null"
      />

      <app-input-generic 
        label="IVA Aplicado"
        type="number"
        formControlName="iva"
        suffix="%"
        placeholder="21"
      />
    </div>

    <div class="form-row">
      <app-input-generic 
        label="Stock Actual"
        type="number"
        formControlName="stock"
        suffix="Kg"
        placeholder="0"
      />

      <app-select-generic
        label="Categoría del artículo"
        [options]="categoriasOpciones" 
        formControlName="categoriaId"
        placeholder="Elige una categoría..."
        [error]="articuloForm.get('categoriaId')?.invalid && articuloForm.get('categoriaId')?.touched ? 'Campo obligatorio' : null"
      ></app-select-generic>
    </div>

  </form>
</app-custom-modal>